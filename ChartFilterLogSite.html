<!DOCTYPE html>
<html>
<head>
  <title>Google Charts Example</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', { packages: ['corechart', 'controls'] });
    google.charts.setOnLoadCallback(drawChart);

    function parseDate(dateString) {
      var dateParts = dateString.split('/');
      return new Date(dateParts[2], dateParts[0] - 1, dateParts[1]);
    }

    function normalizeData(data) {
      var minValue = Number.POSITIVE_INFINITY;
      var maxValue = Number.NEGATIVE_INFINITY;

      // Find the minimum and maximum values in the data
      for (var i = 0; i < data.getNumberOfRows(); i++) {
        for (var j = 1; j <= 10; j++) {
          var value = data.getValue(i, j);
          minValue = Math.min(minValue, value);
          maxValue = Math.max(maxValue, value);
        }
      }

      // Normalize the data
      for (var i = 0; i < data.getNumberOfRows(); i++) {
        for (var j = 1; j <= 10; j++) {
          var normalizedValue = (data.getValue(i, j) - minValue) / (maxValue - minValue);
          data.setValue(i, j, normalizedValue);
        }
      }
    }

    function drawChart() {
      fetch('MomDataUpdateArithmetic.csv') // Updated CSV file path
        .then(response => response.text())
        .then(csvData => {
          var lines = csvData.split('\n');
          var data = new google.visualization.DataTable();
          data.addColumn('date', 'Date');

          // Dynamically add columns for each decile
          for (var i = 1; i <= 10; i++) {
            data.addColumn('number', 'Decile ' + i);
          }

          for (var i = 1; i < lines.length; i++) {
            var parts = lines[i].split(',');
            var date = parseDate(parts[0]);

            var row = [date];
            for (var j = 1; j <= 10; j++) {
              var value = parseFloat(parts[j]);
              row.push(value);
            }

            data.addRow(row);
          }

          normalizeData(data);

          var options = {
            width: 800,
            height: 400,
            title: 'Winners to Losers Portfolios 1927-2023',
            hAxis: {
              format: 'MM/dd/yyyy',
              slantedText: false,
              maxAlternation: 1
            },
            vAxis: {
              title: 'Value',
              viewWindowMode: 'pretty',
              minValue: 0,
              maxValue: 1
            }
          };

          // ...
        });
    }
  </script>
</head>
<body>
  <div id="dashboard">
    <div id="chart_div"></div>
    <div id="filter_div"></div>
  </div>
</body>
</html>
